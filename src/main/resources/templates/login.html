<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout('Iniciar sesión | Banco Forjadores', 'login', false, ~{::content})}">

    <th:block th:fragment="content">
        <a class="visually-hidden-focusable" href="#mainContent">Saltar al contenido</a>

        <div class="container auth-shell d-flex align-items-center py-4">
            <main id="mainContent" class="w-100">
                <div class="row justify-content-center">
                    <div class="col-12 col-sm-10 col-md-7 col-lg-5 col-xl-4">

                        <!-- Brand -->
                        <div class="text-center mb-3">
                            <div class="d-inline-flex align-items-center gap-2">
                                <span class="brand-badge bg-primary text-white" style="width:42px;height:42px;border-radius:14px;">
                                    <i class="bi bi-cash-coin fs-4" aria-hidden="true"></i>
                                </span>
                                <div class="text-start">
                                    <div class="fw-bold text-primary fs-4 mb-0">Banco Forjadores</div>
                                    <div class="small muted">Bienvenido</div>
                                </div>
                            </div>
                        </div>

                        <div class="card auth-card shadow-sm">
                            <div class="card-body p-3 p-sm-4">

                                <div class="mb-3">
                                    <div class="fw-bold fs-5 auth-title mb-1">Iniciar sesión</div>
                                    <div class="small muted">Ingresa tus credenciales para continuar</div>
                                </div>

                                <!-- Alerts (solo cuando aplique) -->
                                <div class="alert alert-danger alert-dismissible fade show d-flex align-items-center"
                                     role="alert" th:if="${param.error}">
                                    <i class="bi bi-exclamation-triangle-fill me-2" aria-hidden="true"></i>
                                    <div class="flex-grow-1">Credenciales inválidas. Verifica usuario y contraseña.</div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                                </div>

                                <div class="alert alert-success alert-dismissible fade show d-flex align-items-center"
                                     role="alert" th:if="${param.logout}">
                                    <i class="bi bi-check-circle-fill me-2" aria-hidden="true"></i>
                                    <div class="flex-grow-1">Sesión cerrada correctamente.</div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                                </div>

                                <!-- Form -->
                                <form th:action="@{/login}" method="post" class="needs-validation" novalidate>

                                    <div class="mb-3">
                                        <label for="correo" class="form-label">Correo</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-white">
                                                <i class="bi bi-person" aria-hidden="true"></i>
                                            </span>
                                            <input id="correo"
                                                   name="correo"
                                                   type="email"
                                                   class="form-control"
                                                   placeholder="ejemplo@bancoF.com"
                                                   autocomplete="username"
                                                   inputmode="email"
                                                   required>
                                            <div class="invalid-feedback">Ingresa tu correo o usuario.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="password" class="form-label">Contraseña</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-white">
                                                <i class="bi bi-lock" aria-hidden="true"></i>
                                            </span>
                                            <input id="password"
                                                   name="password"
                                                   type="password"
                                                   class="form-control"
                                                   placeholder="••••••••"
                                                   autocomplete="current-password"
                                                   required>
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword"
                                                    aria-label="Mostrar u ocultar contraseña">
                                                <i class="bi bi-eye" aria-hidden="true"></i>
                                            </button>
                                            <div class="invalid-feedback">Ingresa tu contraseña.</div>
                                        </div>
                                    </div>

                                    <button class="btn btn-primary w-100" type="submit" id="submitBtn">
                                        <span class="spinner-border spinner-border-sm me-2 d-none"
                                              role="status" aria-hidden="true" id="btnSpinner"></span>
                                        <span id="btnLabel">Entrar</span>
                                    </button>
                                </form>

                            </div>

                            <div class="card-footer bg-white border-top-0 p-3 text-center small muted">
                                © <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2026</span> Banco Forjadores
                            </div>
                        </div>

                    </div>
                </div>
            </main>
        </div>

        <script>
            // Validación + Loading UI
            (() => {
                const forms = document.querySelectorAll('.needs-validation');
                Array.from(forms).forEach(form => {
                    form.addEventListener('submit', event => {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                        } else {
                            const spinner = document.getElementById('btnSpinner');
                            const label = document.getElementById('btnLabel');
                            const btn = document.getElementById('submitBtn');
                            if (spinner && label && btn) {
                                spinner.classList.remove('d-none');
                                label.textContent = 'Ingresando...';
                                btn.disabled = true;
                            }
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            })();

            // Toggle password
            (() => {
                const btn = document.getElementById('togglePassword');
                const input = document.getElementById('password');
                if (!btn || !input)
                    return;

                btn.addEventListener('click', () => {
                    const isPassword = input.getAttribute('type') === 'password';
                    input.setAttribute('type', isPassword ? 'text' : 'password');
                    btn.innerHTML = isPassword
                            ? '<i class="bi bi-eye-slash" aria-hidden="true"></i>'
                            : '<i class="bi bi-eye" aria-hidden="true"></i>';
                });
            })();
        </script>
    </th:block>
</html>
